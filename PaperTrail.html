<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="Bonfire v0.9.10-classic-beta.139">


    <title>PaperTrail â€” Bonfire v0.9.10-classic-beta.139</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-BA2A623E.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>

  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://bonfirenetworks.org" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Bonfire" />
        </a>

      <div>
        <a href="https://bonfirenetworks.org" class="sidebar-projectName" translate="no">
Bonfire
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.9.10-classic-beta.139
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


        <li>
          <button id="tasks-list-tab-button" role="tab" data-type="tasks" aria-controls="tasks-tab-panel" aria-selected="false" tabindex="-1">
            <span translate="no">Mix</span> Tasks
          </button>
        </li>

    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


    <div id="tasks-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="tasks-list-tab-button" hidden>
      <ul id="tasks-full-list" class="full-list"></ul>
    </div>

</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Bonfire</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

    <span translate="no">PaperTrail</span> 
    <small class="app-vsn" translate="no">(Bonfire v0.9.10-classic-beta.139)</small>

  </h1>


    <section id="moduledoc">
<p>Track and record all the changes in your database. Revert back to anytime in history.</p><p><a href="https://hex.pm/packages/paper_trail"><img src="http://img.shields.io/hexpm/v/paper_trail.svg?style=flat" alt="Hex Version"/></a> <a href="https://hexdocs.pm/paper_trail/PaperTrail.html"><img src="http://img.shields.io/badge/hex.pm-docs-green.svg?style=flat" alt="Hex docs"/></a>
<a href="https://hex.pm/packages/paper_trail"><img src="https://img.shields.io/hexpm/dt/paper_trail.svg" alt="Total Download"/></a>
<a href="https://github.com/izelnakri/paper_trail/blob/master/LICENSE"><img src="https://img.shields.io/hexpm/l/paper_trail.svg" alt="License"/></a>
<a href="https://github.com/izelnakri/paper_trail/commits/master"><img src="https://img.shields.io/github/last-commit/izelnakri/paper_trail.svg" alt="Last Updated"/></a></p><h1>How does it work?</h1><p>PaperTrail lets you record every change in your database in a separate database table called <code class="inline">versions</code>. Library generates a new version record with associated data every time you run <a href="#insert/2"><code class="inline">PaperTrail.insert/2</code></a>, <a href="#update/2"><code class="inline">PaperTrail.update/2</code></a> or <a href="#delete/2"><code class="inline">PaperTrail.delete/2</code></a> functions. Simply these functions wrap your Repo insert, update or destroy actions in a database transaction, so if your database action fails you won't get a new version.</p><p>PaperTrail is assailed with hundreds of test assertions for each release. Data integrity is an important aim of this project, please refer to the <code class="inline">strict_mode</code> if you want to ensure data correctness and integrity of your versions. For simpler use cases the default mode of PaperTrail should suffice.</p><h2 id="module-example" class="section-heading">
  <a href="#module-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Post</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="7348691115-1">(</span><span class="p" data-group-id="7348691115-2">%</span><span class="nc" data-group-id="7348691115-2">Post</span><span class="p" data-group-id="7348691115-2">{</span><span class="p" data-group-id="7348691115-2">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7348691115-3">%{</span><span class="w">
  </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Word on the street is Elixir got its own database versioning library&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;You should try it now!&quot;</span><span class="w">
</span><span class="p" data-group-id="7348691115-3">}</span><span class="p" data-group-id="7348691115-1">)</span><span class="w">

</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="7348691115-4">(</span><span class="n">changeset</span><span class="p" data-group-id="7348691115-4">)</span><span class="w">
</span><span class="c1"># =&gt; on success:</span><span class="w">
</span><span class="c1"># {:ok,</span><span class="w">
</span><span class="c1">#  %{model: %Post{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;posts&quot;&gt;,</span><span class="w">
</span><span class="c1">#     title: &quot;Word on the street is Elixir got its own database versioning library&quot;,</span><span class="w">
</span><span class="c1">#     content: &quot;You should try it now!&quot;, id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#     updated_at: ~N[2016-09-15 21:42:38]},</span><span class="w">
</span><span class="c1">#    version: %PaperTrail.Version{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;versions&quot;&gt;,</span><span class="w">
</span><span class="c1">#     event: &quot;insert&quot;, id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#     item_changes: %{title: &quot;Word on the street is Elixir got its own database versioning library&quot;,</span><span class="w">
</span><span class="c1">#       content: &quot;You should try it now!&quot;, id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#       updated_at: ~N[2016-09-15 21:42:38]},</span><span class="w">
</span><span class="c1">#     item_id: 1, item_type: &quot;Post&quot;, originator_id: nil, originator: nil, meta: nil}}}</span><span class="w">

</span><span class="c1"># =&gt; on error(it matches Repo.insert/2):</span><span class="w">
</span><span class="c1"># {:error, Ecto.Changeset&lt;action: :insert,</span><span class="w">
</span><span class="c1">#  changes: %{title: &quot;Word on the street is Elixir got its own database versioning library&quot;, content: &quot;You should try it now!&quot;},</span><span class="w">
</span><span class="c1">#  errors: [content: {&quot;is too short&quot;, []}], data: #Post&lt;&gt;,</span><span class="w">
</span><span class="c1">#  valid?: false&gt;, %{}}</span><span class="w">

</span><span class="n">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="7348691115-5">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="7348691115-5">)</span><span class="w">
</span><span class="n">edit_changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Post</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="7348691115-6">(</span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7348691115-7">%{</span><span class="w">
  </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Elixir matures fast&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Future is already here, Elixir is the next step!&quot;</span><span class="w">
</span><span class="p" data-group-id="7348691115-7">}</span><span class="p" data-group-id="7348691115-6">)</span><span class="w">

</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="7348691115-8">(</span><span class="n">edit_changeset</span><span class="p" data-group-id="7348691115-8">)</span><span class="w">
</span><span class="c1"># =&gt; on success:</span><span class="w">
</span><span class="c1"># {:ok,</span><span class="w">
</span><span class="c1">#  %{model: %Post{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;posts&quot;&gt;,</span><span class="w">
</span><span class="c1">#     title: &quot;Elixir matures fast&quot;, content: &quot;Future is already here, Elixir is the next step!&quot;,</span><span class="w">
</span><span class="c1">#     id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#     updated_at: ~N[2016-09-15 22:00:59]},</span><span class="w">
</span><span class="c1">#    version: %PaperTrail.Version{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;versions&quot;&gt;,</span><span class="w">
</span><span class="c1">#     event: &quot;update&quot;, id: 2, inserted_at: ~N[2016-09-15 22:00:59],</span><span class="w">
</span><span class="c1">#     item_changes: %{title: &quot;Elixir matures fast&quot;, content: &quot;Future is already here, Elixir is the next step!&quot;},</span><span class="w">
</span><span class="c1">#     item_id: 1, item_type: &quot;Post&quot;, originator_id: nil, originator: nil</span><span class="w">
</span><span class="c1">#     meta: nil}}}</span><span class="w">

</span><span class="c1"># =&gt; on error(it matches Repo.update/2):</span><span class="w">
</span><span class="c1"># {:error, Ecto.Changeset&lt;action: :update,</span><span class="w">
</span><span class="c1">#  changes: %{title: &quot;Elixir matures fast&quot;, content: &quot;Future is already here, Elixir is the next step!&quot;},</span><span class="w">
</span><span class="c1">#  errors: [title: {&quot;is too short&quot;, []}], data: #Post&lt;&gt;,</span><span class="w">
</span><span class="c1">#  valid?: false&gt;, %{}}</span><span class="w">

</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">get_version</span><span class="p" data-group-id="7348691115-9">(</span><span class="n">post</span><span class="p" data-group-id="7348691115-9">)</span><span class="w">
</span><span class="c1">#  %PaperTrail.Version{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;versions&quot;&gt;,</span><span class="w">
</span><span class="c1">#   event: &quot;update&quot;, id: 2, inserted_at: ~N[2016-09-15 22:00:59],</span><span class="w">
</span><span class="c1">#   item_changes: %{title: &quot;Elixir matures fast&quot;, content: &quot;Future is already here, Elixir is the next step!&quot;},</span><span class="w">
</span><span class="c1">#   item_id: 1, item_type: &quot;Post&quot;, originator_id: nil, originator: nil, meta: nil}}}</span><span class="w">

</span><span class="n">updated_post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="7348691115-10">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="7348691115-10">)</span><span class="w">

</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">delete</span><span class="p" data-group-id="7348691115-11">(</span><span class="n">updated_post</span><span class="p" data-group-id="7348691115-11">)</span><span class="w">
</span><span class="c1"># =&gt; on success:</span><span class="w">
</span><span class="c1"># {:ok,</span><span class="w">
</span><span class="c1">#  %{model: %Post{__meta__: #Ecto.Schema.Metadata&lt;:deleted, &quot;posts&quot;&gt;,</span><span class="w">
</span><span class="c1">#     title: &quot;Elixir matures fast&quot;, content: &quot;Future is already here, Elixir is the next step!&quot;,</span><span class="w">
</span><span class="c1">#     id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#     updated_at: ~N[2016-09-15 22:00:59]},</span><span class="w">
</span><span class="c1">#    version: %PaperTrail.Version{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;versions&quot;&gt;,</span><span class="w">
</span><span class="c1">#     event: &quot;delete&quot;, id: 3, inserted_at: ~N[2016-09-15 22:22:12],</span><span class="w">
</span><span class="c1">#     item_changes: %{title: &quot;Elixir matures fast&quot;, content: &quot;Future is already here, Elixir is the next step!&quot;,</span><span class="w">
</span><span class="c1">#       id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#       updated_at: ~N[2016-09-15 22:00:59]},</span><span class="w">
</span><span class="c1">#     item_id: 1, item_type: &quot;Post&quot;, originator_id: nil, originator: nil, meta: nil}}}</span><span class="w">

</span><span class="nc">Repo</span><span class="o">.</span><span class="n">aggregate</span><span class="p" data-group-id="7348691115-12">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">:count</span><span class="p">,</span><span class="w"> </span><span class="ss">:id</span><span class="p" data-group-id="7348691115-12">)</span><span class="w"> </span><span class="c1"># =&gt; 0</span><span class="w">
</span><span class="nc">PaperTrail.Version</span><span class="o">.</span><span class="n">count</span><span class="p" data-group-id="7348691115-13">(</span><span class="p" data-group-id="7348691115-13">)</span><span class="w"> </span><span class="c1"># =&gt; 3</span><span class="w">
</span><span class="c1"># same as Repo.aggregate(PaperTrail.Version, :count, :id)</span><span class="w">

</span><span class="nc">PaperTrail.Version</span><span class="o">.</span><span class="n">last</span><span class="p" data-group-id="7348691115-14">(</span><span class="p" data-group-id="7348691115-14">)</span><span class="w"> </span><span class="c1"># returns the last version in the db by inserted_at</span><span class="w">
</span><span class="c1">#  %PaperTrail.Version{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;versions&quot;&gt;,</span><span class="w">
</span><span class="c1">#   event: &quot;delete&quot;, id: 3, inserted_at: ~N[2016-09-15 22:22:12],</span><span class="w">
</span><span class="c1">#   item_changes: %{&quot;title&quot; =&gt; &quot;Elixir matures fast&quot;, content: &quot;Future is already here, Elixir is the next step!&quot;, &quot;id&quot; =&gt; 1,</span><span class="w">
</span><span class="c1">#     &quot;inserted_at&quot; =&gt; &quot;2016-09-15T21:42:38&quot;,</span><span class="w">
</span><span class="c1">#     &quot;updated_at&quot; =&gt; &quot;2016-09-15T22:00:59&quot;},</span><span class="w">
</span><span class="c1">#   item_id: 1, item_type: &quot;Post&quot;, originator_id: nil, originator: nil, meta: nil}</span></code></pre><p>PaperTrail is inspired by the ruby gem <code class="inline">paper_trail</code>. However, unlike the <code class="inline">paper_trail</code> gem this library actually results in less data duplication, faster and more explicit programming model to version your record changes.</p><p>The library source code is minimal and well tested. It is suggested to read the source code.</p><h2 id="module-installation" class="section-heading">
  <a href="#module-installation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Installation</span>
</h2>
<ol><li><p> Add paper_trail to your list of dependencies in <code class="inline">mix.exs</code>:</p><pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">deps</span><span class="w"> </span><span class="k" data-group-id="5235379951-1">do</span><span class="w">
  </span><span class="p" data-group-id="5235379951-2">[</span><span class="p" data-group-id="5235379951-3">{</span><span class="ss">:paper_trail</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.14.3&quot;</span><span class="p" data-group-id="5235379951-3">}</span><span class="p" data-group-id="5235379951-2">]</span><span class="w">
</span><span class="k" data-group-id="5235379951-1">end</span></code></pre></li><li><p> Configure paper_trail to use your application repo in <code class="inline">config/config.exs</code>:</p><pre><code class="makeup elixir" translate="no"><span class="n">config</span><span class="w"> </span><span class="ss">:paper_trail</span><span class="p">,</span><span class="w"> </span><span class="ss">repo</span><span class="p">:</span><span class="w"> </span><span class="nc">YourApplicationName.Repo</span><span class="w">
</span><span class="c1"># if you don&#39;t specify this PaperTrail will assume your repo name is Repo</span></code></pre></li><li><p> Install and compile your dependency:</p><p><code class="inline">mix deps.get &amp;&amp; mix compile</code></p></li><li><p> Run this command to generate the migration:</p><p><a href="./Mix.Tasks.Papertrail.Install.html"><code class="inline">mix papertrail.install</code></a></p><p>You might want to edit the types for <code class="inline">:item_id</code> or <code class="inline">:originator_id</code> if you're
using UUID or other types for your primary keys before you execute
<a href="https://hexdocs.pm/ecto_sql/3.12.0/Mix.Tasks.Ecto.Migrate.html"><code class="inline">mix ecto.migrate</code></a>.</p></li><li><p> Run the migration:</p><p><a href="https://hexdocs.pm/ecto_sql/3.12.0/Mix.Tasks.Ecto.Migrate.html"><code class="inline">mix ecto.migrate</code></a></p></li></ol><p>Your application is now ready to collect some history!</p><h4>Does this work with phoenix?</h4><p>YES! Make sure you do the steps above.</p><h3 id="module-papertrail-version-fields" class="section-heading">
  <a href="#module-papertrail-version-fields" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">%PaperTrail.Version{} fields:</span>
</h3>
<table><thead><tr><th style="text-align: left;">Column Name</th><th style="text-align: left;">Type</th><th style="text-align: left;">Description</th><th style="text-align: left;">Entry Method</th></tr></thead><tbody><tr><td style="text-align: left;">event</td><td style="text-align: left;">String</td><td style="text-align: left;">either &quot;insert&quot;, &quot;update&quot; or &quot;delete&quot;</td><td style="text-align: left;">Library generates</td></tr><tr><td style="text-align: left;">item_type</td><td style="text-align: left;">String</td><td style="text-align: left;">model name of the reference record</td><td style="text-align: left;">Library generates</td></tr><tr><td style="text-align: left;">item_id</td><td style="text-align: left;">configurable (Integer by default)</td><td style="text-align: left;">model id of the reference record</td><td style="text-align: left;">Library generates</td></tr><tr><td style="text-align: left;">item_changes</td><td style="text-align: left;">Map</td><td style="text-align: left;">all the changes in this version as a map</td><td style="text-align: left;">Library generates</td></tr><tr><td style="text-align: left;">originator_id</td><td style="text-align: left;">configurable (Integer by default)</td><td style="text-align: left;">foreign key reference to the creator/owner of this change</td><td style="text-align: left;">Optionally set</td></tr><tr><td style="text-align: left;">origin</td><td style="text-align: left;">String</td><td style="text-align: left;">short reference to origin(eg. worker:activity-checker, migration, admin:33)</td><td style="text-align: left;">Optionally set</td></tr><tr><td style="text-align: left;">meta</td><td style="text-align: left;">Map</td><td style="text-align: left;">any extra optional meta information about the version(eg. %{slug: &quot;ausername&quot;, important: true})</td><td style="text-align: left;">Optionally set</td></tr><tr><td style="text-align: left;">inserted_at</td><td style="text-align: left;">Date</td><td style="text-align: left;">inserted_at timestamp</td><td style="text-align: left;">Ecto generates</td></tr></tbody></table><h4>Configuring the types</h4><p>If you are using UUID or another type for your primary keys, you can configure
the PaperTrail.Version schema to use it.</p><h5>Example Config</h5><pre><code class="makeup elixir" translate="no"><span class="n">config</span><span class="w"> </span><span class="ss">:paper_trail</span><span class="p">,</span><span class="w"> </span><span class="ss">item_type</span><span class="p">:</span><span class="w"> </span><span class="nc">Ecto.UUID</span><span class="p">,</span><span class="w">
                     </span><span class="ss">originator_type</span><span class="p">:</span><span class="w"> </span><span class="nc">Ecto.UUID</span><span class="p">,</span><span class="w">
                     </span><span class="ss">originator_relationship_options</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3638372594-1">[</span><span class="ss">references</span><span class="p">:</span><span class="w"> </span><span class="ss">:uuid</span><span class="p" data-group-id="3638372594-1">]</span></code></pre><h6>Example User</h6><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Acme.User</span><span class="w"> </span><span class="k" data-group-id="8787272212-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ecto.Schema</span><span class="w">

  </span><span class="na">@primary_key</span><span class="w"> </span><span class="p" data-group-id="8787272212-2">{</span><span class="ss">:uuid</span><span class="p">,</span><span class="w"> </span><span class="ss">:binary_id</span><span class="p">,</span><span class="w"> </span><span class="ss">autogenerate</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="8787272212-2">}</span><span class="w">
  </span><span class="n">schema</span><span class="w"> </span><span class="s">&quot;users&quot;</span><span class="w"> </span><span class="k" data-group-id="8787272212-3">do</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:email</span><span class="p">,</span><span class="w"> </span><span class="ss">:string</span><span class="w">

    </span><span class="n">timestamps</span><span class="p" data-group-id="8787272212-4">(</span><span class="p" data-group-id="8787272212-4">)</span><span class="w">
  </span><span class="k" data-group-id="8787272212-3">end</span></code></pre><p>Remember to edit the types accordingly in the generated migration.</p><h3 id="module-version-origin-references" class="section-heading">
  <a href="#module-version-origin-references" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Version origin references:</span>
</h3>
<p>PaperTrail records have a string field called <code class="inline">origin</code>. <a href="#insert/2"><code class="inline">PaperTrail.insert/2</code></a>, <a href="#update/2"><code class="inline">PaperTrail.update/2</code></a>, <a href="#delete/2"><code class="inline">PaperTrail.delete/2</code></a> functions accept a second argument to describe the origin of this version:</p><pre><code class="makeup elixir" translate="no"><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="6120153161-1">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">origin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;migration&quot;</span><span class="p" data-group-id="6120153161-1">)</span><span class="w">
</span><span class="c1"># or:</span><span class="w">
</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="6120153161-2">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">origin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user:1234&quot;</span><span class="p" data-group-id="6120153161-2">)</span><span class="w">
</span><span class="c1"># or:</span><span class="w">
</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">delete</span><span class="p" data-group-id="6120153161-3">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">origin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;worker:delete_inactive_users&quot;</span><span class="p" data-group-id="6120153161-3">)</span><span class="w">
</span><span class="c1"># or:</span><span class="w">
</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="6120153161-4">(</span><span class="n">new_user_changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">origin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;password_registration&quot;</span><span class="p" data-group-id="6120153161-4">)</span><span class="w">
</span><span class="c1"># or:</span><span class="w">
</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="6120153161-5">(</span><span class="n">new_user_changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">origin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;facebook_registration&quot;</span><span class="p" data-group-id="6120153161-5">)</span></code></pre><h3 id="module-version-originator-relationships" class="section-heading">
  <a href="#module-version-originator-relationships" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Version originator relationships</span>
</h3>
<p>You can specify setter/originator relationship to paper_trail versions with <code class="inline">originator</code> assignment. This feature is only possible by specifying <code class="inline">:originator</code> keyword list for your application configuration:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># In your config/config.exs</span><span class="w">
</span><span class="n">config</span><span class="w"> </span><span class="ss">:paper_trail</span><span class="p">,</span><span class="w"> </span><span class="ss">originator</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8636147283-1">[</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p">,</span><span class="w"> </span><span class="ss">model</span><span class="p">:</span><span class="w"> </span><span class="nc">YourApp.User</span><span class="p" data-group-id="8636147283-1">]</span><span class="w">
</span><span class="c1"># For most applications originator should be the user since models can be updated/created/deleted by several users.</span></code></pre><p>Note: You will need to recompile your deps after you have added the config for originator.</p><p>Then originator name could be used for querying and preloading. Originator setting must be done via <code class="inline">:originator</code> or originator name that is defined in the paper_trail configuration:</p><pre><code class="makeup elixir" translate="no"><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_user</span><span class="p" data-group-id="8744449478-1">(</span><span class="p" data-group-id="8744449478-1">)</span><span class="w">
</span><span class="c1"># all these set originator_id&#39;s for the version records</span><span class="w">
</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="8744449478-2">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">originator</span><span class="p">:</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="8744449478-2">)</span><span class="w">
</span><span class="p" data-group-id="8744449478-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="8744449478-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="8744449478-4">(</span><span class="n">edit_changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">originator</span><span class="p">:</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="8744449478-4">)</span><span class="w">
</span><span class="c1"># or you can use :user in the params instead of :originator if this is your config:</span><span class="w">
</span><span class="c1"># config :paper_trail, originator: [name: :user, model: YourApplication.User]</span><span class="w">
</span><span class="p" data-group-id="8744449478-5">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="8744449478-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="8744449478-6">(</span><span class="n">edit_changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">user</span><span class="p">:</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="8744449478-6">)</span><span class="w">
</span><span class="n">result</span><span class="p" data-group-id="8744449478-7">[</span><span class="ss">:version</span><span class="p" data-group-id="8744449478-7">]</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">preload</span><span class="p" data-group-id="8744449478-8">(</span><span class="ss">:user</span><span class="p" data-group-id="8744449478-8">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="8744449478-9">(</span><span class="ss">:user</span><span class="p" data-group-id="8744449478-9">)</span><span class="w"> </span><span class="c1"># we can access the user who made the change from the version thanks to originator relationships!</span><span class="w">
</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">delete</span><span class="p" data-group-id="8744449478-10">(</span><span class="n">edit_changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">user</span><span class="p">:</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="8744449478-10">)</span></code></pre><p>Also make sure you have the foreign-key constraint in the database and in your version migration file.</p><h3 id="module-storing-version-meta-data" class="section-heading">
  <a href="#module-storing-version-meta-data" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Storing version meta data</span>
</h3>
<p>You might want to add some meta data that doesn't belong to <code class="inline">originator</code> and <code class="inline">origin</code> fields. Such data could be stored in one object named <code class="inline">meta</code> in paper_trail versions. Meta field could be passed as the second optional parameter to PaperTrail.insert/2, PaperTrail.update/2, PaperTrail.delete/2 functions:</p><pre><code class="makeup elixir" translate="no"><span class="n">company</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Company</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="4432725132-1">(</span><span class="p" data-group-id="4432725132-2">%</span><span class="nc" data-group-id="4432725132-2">Company</span><span class="p" data-group-id="4432725132-2">{</span><span class="p" data-group-id="4432725132-2">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4432725132-3">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Acme Inc.&quot;</span><span class="p" data-group-id="4432725132-3">}</span><span class="p" data-group-id="4432725132-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="4432725132-4">(</span><span class="ss">meta</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4432725132-5">%{</span><span class="ss">slug</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;acme-llc&quot;</span><span class="p" data-group-id="4432725132-5">}</span><span class="p" data-group-id="4432725132-4">)</span><span class="w">

</span><span class="c1"># You can also combine this with an origin:</span><span class="w">
</span><span class="n">edited_company</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Company</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="4432725132-6">(</span><span class="n">company</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4432725132-7">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Acme LLC&quot;</span><span class="p" data-group-id="4432725132-7">}</span><span class="p" data-group-id="4432725132-6">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="4432725132-8">(</span><span class="ss">origin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;documentation&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">meta</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4432725132-9">%{</span><span class="ss">slug</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;acme-llc&quot;</span><span class="p" data-group-id="4432725132-9">}</span><span class="p" data-group-id="4432725132-8">)</span><span class="w">

</span><span class="c1"># Or even with an originator:</span><span class="w">
</span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_user</span><span class="p" data-group-id="4432725132-10">(</span><span class="p" data-group-id="4432725132-10">)</span><span class="w">
</span><span class="n">deleted_company</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Company</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="4432725132-11">(</span><span class="n">edited_company</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4432725132-12">%{</span><span class="p" data-group-id="4432725132-12">}</span><span class="p" data-group-id="4432725132-11">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">delete</span><span class="p" data-group-id="4432725132-13">(</span><span class="ss">origin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;worker:github&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">originator</span><span class="p">:</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="ss">meta</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4432725132-14">%{</span><span class="ss">slug</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;acme-llc&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">important</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="4432725132-14">}</span><span class="p" data-group-id="4432725132-13">)</span></code></pre><h1>Strict mode</h1><p>This is a feature more suitable for larger applications. Models can keep their version references via foreign key constraints. Therefore it would be impossible to delete the first and current version of a model if the model exists in the database, it also makes querying easier and the whole design more relational database/SQL friendly. In order to enable strict mode:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># In your config/config.exs</span><span class="w">
</span><span class="n">config</span><span class="w"> </span><span class="ss">:paper_trail</span><span class="p">,</span><span class="w"> </span><span class="ss">strict_mode</span><span class="p">:</span><span class="w"> </span><span class="no">true</span></code></pre><p>Strict mode expects tracked models to have foreign-key reference to their first_version and current_version. These columns must be named <code class="inline">first_version_id</code>, and <code class="inline">current_version_id</code> in their respective model tables. A tracked model example with a migration file:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># In the migration file: priv/repo/migrations/create_company.exs</span><span class="w">
</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Repo.Migrations.CreateCompany</span><span class="w"> </span><span class="k" data-group-id="0836283261-1">do</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">change</span><span class="w"> </span><span class="k" data-group-id="0836283261-2">do</span><span class="w">
    </span><span class="n">create</span><span class="w"> </span><span class="n">table</span><span class="p" data-group-id="0836283261-3">(</span><span class="ss">:companies</span><span class="p" data-group-id="0836283261-3">)</span><span class="w"> </span><span class="k" data-group-id="0836283261-4">do</span><span class="w">
      </span><span class="n">add</span><span class="w"> </span><span class="ss">:name</span><span class="p">,</span><span class="w">       </span><span class="ss">:string</span><span class="p">,</span><span class="w"> </span><span class="ss">null</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">
      </span><span class="n">add</span><span class="w"> </span><span class="ss">:founded_in</span><span class="p">,</span><span class="w"> </span><span class="ss">:date</span><span class="w">

      </span><span class="c1"># null constraints are highly suggested:</span><span class="w">
      </span><span class="n">add</span><span class="w"> </span><span class="ss">:first_version_id</span><span class="p">,</span><span class="w"> </span><span class="n">references</span><span class="p" data-group-id="0836283261-5">(</span><span class="ss">:versions</span><span class="p" data-group-id="0836283261-5">)</span><span class="p">,</span><span class="w"> </span><span class="ss">null</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">
      </span><span class="n">add</span><span class="w"> </span><span class="ss">:current_version_id</span><span class="p">,</span><span class="w"> </span><span class="n">references</span><span class="p" data-group-id="0836283261-6">(</span><span class="ss">:versions</span><span class="p" data-group-id="0836283261-6">)</span><span class="p">,</span><span class="w"> </span><span class="ss">null</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">

      </span><span class="n">timestamps</span><span class="p" data-group-id="0836283261-7">(</span><span class="p" data-group-id="0836283261-7">)</span><span class="w">
    </span><span class="k" data-group-id="0836283261-4">end</span><span class="w">

    </span><span class="n">create</span><span class="w"> </span><span class="n">unique_index</span><span class="p" data-group-id="0836283261-8">(</span><span class="ss">:companies</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0836283261-9">[</span><span class="ss">:first_version_id</span><span class="p" data-group-id="0836283261-9">]</span><span class="p" data-group-id="0836283261-8">)</span><span class="w">
    </span><span class="n">create</span><span class="w"> </span><span class="n">unique_index</span><span class="p" data-group-id="0836283261-10">(</span><span class="ss">:companies</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0836283261-11">[</span><span class="ss">:current_version_id</span><span class="p" data-group-id="0836283261-11">]</span><span class="p" data-group-id="0836283261-10">)</span><span class="w">
  </span><span class="k" data-group-id="0836283261-2">end</span><span class="w">
</span><span class="k" data-group-id="0836283261-1">end</span><span class="w">

</span><span class="c1"># In the model definition:</span><span class="w">
</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Company</span><span class="w"> </span><span class="k" data-group-id="0836283261-12">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ecto.Schema</span><span class="w">

  </span><span class="kn">import</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="w">

  </span><span class="n">schema</span><span class="w"> </span><span class="s">&quot;companies&quot;</span><span class="w"> </span><span class="k" data-group-id="0836283261-13">do</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="ss">:string</span><span class="w">
    </span><span class="n">field</span><span class="w"> </span><span class="ss">:founded_in</span><span class="p">,</span><span class="w"> </span><span class="ss">:date</span><span class="w">

    </span><span class="n">belongs_to</span><span class="w"> </span><span class="ss">:first_version</span><span class="p">,</span><span class="w"> </span><span class="nc">PaperTrail.Version</span><span class="w">
    </span><span class="n">belongs_to</span><span class="w"> </span><span class="ss">:current_version</span><span class="p">,</span><span class="w"> </span><span class="nc">PaperTrail.Version</span><span class="p">,</span><span class="w"> </span><span class="ss">on_replace</span><span class="p">:</span><span class="w"> </span><span class="ss">:update</span><span class="w"> </span><span class="c1"># on_replace: is important!</span><span class="w">

    </span><span class="n">timestamps</span><span class="p" data-group-id="0836283261-14">(</span><span class="p" data-group-id="0836283261-14">)</span><span class="w">
  </span><span class="k" data-group-id="0836283261-13">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">changeset</span><span class="p" data-group-id="0836283261-15">(</span><span class="n">struct</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="p" data-group-id="0836283261-16">%{</span><span class="p" data-group-id="0836283261-16">}</span><span class="p" data-group-id="0836283261-15">)</span><span class="w"> </span><span class="k" data-group-id="0836283261-17">do</span><span class="w">
    </span><span class="n">struct</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">cast</span><span class="p" data-group-id="0836283261-18">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0836283261-19">[</span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="ss">:founded_in</span><span class="p" data-group-id="0836283261-19">]</span><span class="p" data-group-id="0836283261-18">)</span><span class="w">
  </span><span class="k" data-group-id="0836283261-17">end</span><span class="w">
</span><span class="k" data-group-id="0836283261-12">end</span></code></pre><p>When you run PaperTrail.insert/2 transaction, <code class="inline">first_version_id</code> and <code class="inline">current_version_id</code> automagically gets assigned for the model. Example:</p><pre><code class="makeup elixir" translate="no"><span class="n">company</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Company</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="3235027926-1">(</span><span class="p" data-group-id="3235027926-2">%</span><span class="nc" data-group-id="3235027926-2">Company</span><span class="p" data-group-id="3235027926-2">{</span><span class="p" data-group-id="3235027926-2">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3235027926-3">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Acme LLC&quot;</span><span class="p" data-group-id="3235027926-3">}</span><span class="p" data-group-id="3235027926-1">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">insert</span><span class="w">
</span><span class="c1"># {:ok,</span><span class="w">
</span><span class="c1">#  %{model: %Company{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;companies&quot;&gt;,</span><span class="w">
</span><span class="c1">#     name: &quot;Acme LLC&quot;, founded_in: nil, id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#     updated_at: ~N[2016-09-15 21:42:38], first_version_id: 1, current_version_id: 1},</span><span class="w">
</span><span class="c1">#    version: %PaperTrail.Version{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;versions&quot;&gt;,</span><span class="w">
</span><span class="c1">#      event: &quot;insert&quot;, id: 1, inserted_at: ~N[2016-09-15 22:22:12],</span><span class="w">
</span><span class="c1">#      item_changes: %{name: &quot;Acme LLC&quot;, founded_in: nil, id: 1, inserted_at: ~N[2016-09-15 21:42:38]},</span><span class="w">
</span><span class="c1">#      originator_id: nil, origin: &quot;unknown&quot;, meta: nil}}}</span></code></pre><p>When you PaperTrail.update/2 a model, <code class="inline">current_version_id</code> gets updated during the transaction:</p><pre><code class="makeup elixir" translate="no"><span class="n">edited_company</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Company</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="9981706117-1">(</span><span class="n">company</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9981706117-2">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Acme Inc.&quot;</span><span class="p" data-group-id="9981706117-2">}</span><span class="p" data-group-id="9981706117-1">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="9981706117-3">(</span><span class="ss">origin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;documentation&quot;</span><span class="p" data-group-id="9981706117-3">)</span><span class="w">
</span><span class="c1"># {:ok,</span><span class="w">
</span><span class="c1">#  %{model: %Company{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;companies&quot;&gt;,</span><span class="w">
</span><span class="c1">#     name: &quot;Acme Inc.&quot;, founded_in: nil, id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#     updated_at: ~N[2016-09-15 23:22:12], first_version_id: 1, current_version_id: 2},</span><span class="w">
</span><span class="c1">#    version: %PaperTrail.Version{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;versions&quot;&gt;,</span><span class="w">
</span><span class="c1">#      event: &quot;update&quot;, id: 2, inserted_at: ~N[2016-09-15 23:22:12],</span><span class="w">
</span><span class="c1">#      item_changes: %{name: &quot;Acme Inc.&quot;}, originator_id: nil, origin: &quot;documentation&quot;, meta: nil}}}</span></code></pre><p>Additionally, you can put a null constraint on <code class="inline">origin</code> column, you should always put an <code class="inline">origin</code> reference to describe who makes the change. This is important for big applications because a model can change from many sources.</p><h3 id="module-bang-functions" class="section-heading">
  <a href="#module-bang-functions" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Bang(!) functions:</span>
</h3>
<p>PaperTrail also supports <code class="inline">PaperTrail.insert!</code>, <code class="inline">PaperTrail.update!</code>, <code class="inline">PaperTrail.delete!</code>. Naming of these functions intentionally match <code class="inline">Repo.insert!</code>, <code class="inline">Repo.update!</code>, <code class="inline">Repo.delete!</code> functions. If PaperTrail is on strict_mode these bang functions will update the version references of the model just like the normal PaperTrail operations.</p><p>Bang functions assume the operation will always be successful, otherwise functions will raise <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.InvalidChangesetError.html"><code class="inline">Ecto.InvalidChangesetError</code></a> just like <code class="inline">Repo.insert!</code>, <code class="inline">Repo.update!</code> and <code class="inline">Repo.delete!</code>:</p><pre><code class="makeup elixir" translate="no"><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Post</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="2430018039-1">(</span><span class="p" data-group-id="2430018039-2">%</span><span class="nc" data-group-id="2430018039-2">Post</span><span class="p" data-group-id="2430018039-2">{</span><span class="p" data-group-id="2430018039-2">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2430018039-3">%{</span><span class="w">
  </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Word on the street is Elixir got its own database versioning library&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;You should try it now!&quot;</span><span class="w">
</span><span class="p" data-group-id="2430018039-3">}</span><span class="p" data-group-id="2430018039-1">)</span><span class="w">

</span><span class="n">inserted_post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">insert!</span><span class="p" data-group-id="2430018039-4">(</span><span class="n">changeset</span><span class="p" data-group-id="2430018039-4">)</span><span class="w">
</span><span class="c1"># =&gt; on success:</span><span class="w">
</span><span class="c1"># %Post{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;posts&quot;&gt;,</span><span class="w">
</span><span class="c1">#   title: &quot;Word on the street is Elixir got its own database versioning library&quot;,</span><span class="w">
</span><span class="c1">#   content: &quot;You should try it now!&quot;, id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#   updated_at: ~N[2016-09-15 21:42:38]</span><span class="w">
</span><span class="c1"># }</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1"># =&gt; on error raises: Ecto.InvalidChangesetError !!</span><span class="w">

</span><span class="n">inserted_post_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">get_version</span><span class="p" data-group-id="2430018039-5">(</span><span class="n">inserted_post</span><span class="p" data-group-id="2430018039-5">)</span><span class="w">
</span><span class="c1"># %PaperTrail.Version{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;versions&quot;&gt;,</span><span class="w">
</span><span class="c1">#   event: &quot;insert&quot;, id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#   item_changes: %{title: &quot;Word on the street is Elixir got its own database versioning library&quot;,</span><span class="w">
</span><span class="c1">#     content: &quot;You should try it now!&quot;, id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#     updated_at: ~N[2016-09-15 21:42:38]},</span><span class="w">
</span><span class="c1">#   item_id: 1, item_type: &quot;Post&quot;, originator_id: nil, originator: nil, meta: nil}</span><span class="w">

</span><span class="n">edit_changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Post</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="2430018039-6">(</span><span class="n">inserted_post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2430018039-7">%{</span><span class="w">
  </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Elixir matures fast&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Future is already here, Elixir is the next step!&quot;</span><span class="w">
</span><span class="p" data-group-id="2430018039-7">}</span><span class="p" data-group-id="2430018039-6">)</span><span class="w">

</span><span class="n">updated_post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">update!</span><span class="p" data-group-id="2430018039-8">(</span><span class="n">edit_changeset</span><span class="p" data-group-id="2430018039-8">)</span><span class="w">
</span><span class="c1"># =&gt; on success:</span><span class="w">
</span><span class="c1"># %Post{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;posts&quot;&gt;,</span><span class="w">
</span><span class="c1">#   title: &quot;Elixir matures fast&quot;, content: &quot;Future is already here, you deserve to be awesome!&quot;,</span><span class="w">
</span><span class="c1">#   id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#   updated_at: ~N[2016-09-15 22:00:59]}</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1"># =&gt; on error raises: Ecto.InvalidChangesetError !!</span><span class="w">

</span><span class="n">updated_post_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">get_version</span><span class="p" data-group-id="2430018039-9">(</span><span class="n">updated_post</span><span class="p" data-group-id="2430018039-9">)</span><span class="w">
</span><span class="c1"># %PaperTrail.Version{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;versions&quot;&gt;,</span><span class="w">
</span><span class="c1">#   event: &quot;update&quot;, id: 2, inserted_at: ~N[2016-09-15 22:00:59],</span><span class="w">
</span><span class="c1">#   item_changes: %{title: &quot;Elixir matures fast&quot;, content: &quot;Future is already here, Elixir is the next step!&quot;},</span><span class="w">
</span><span class="c1">#   item_id: 1, item_type: &quot;Post&quot;, originator_id: nil, originator: nil</span><span class="w">
</span><span class="c1">#   meta: nil}</span><span class="w">

</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">delete!</span><span class="p" data-group-id="2430018039-10">(</span><span class="n">updated_post</span><span class="p" data-group-id="2430018039-10">)</span><span class="w">
</span><span class="c1"># =&gt; on success:</span><span class="w">
</span><span class="c1"># %Post{__meta__: #Ecto.Schema.Metadata&lt;:deleted, &quot;posts&quot;&gt;,</span><span class="w">
</span><span class="c1">#   title: &quot;Elixir matures fast&quot;, content: &quot;Future is already here, Elixir is the next step!&quot;,</span><span class="w">
</span><span class="c1">#   id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#   updated_at: ~N[2016-09-15 22:00:59]}</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1"># =&gt; on error raises: Ecto.InvalidChangesetError !!</span><span class="w">

</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">get_version</span><span class="p" data-group-id="2430018039-11">(</span><span class="n">updated_post</span><span class="p" data-group-id="2430018039-11">)</span><span class="w">
</span><span class="c1"># %PaperTrail.Version{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;versions&quot;&gt;,</span><span class="w">
</span><span class="c1">#   event: &quot;delete&quot;, id: 3, inserted_at: ~N[2016-09-15 22:22:12],</span><span class="w">
</span><span class="c1">#   item_changes: %{title: &quot;Elixir matures fast&quot;, content: &quot;Future is already here, Elixir is the next step!&quot;,</span><span class="w">
</span><span class="c1">#   id: 1, inserted_at: ~N[2016-09-15 21:42:38],</span><span class="w">
</span><span class="c1">#   updated_at: ~N[2016-09-15 22:00:59]},</span><span class="w">
</span><span class="c1">#   item_id: 1, item_type: &quot;Post&quot;, originator_id: nil, originator: nil, meta: nil}</span><span class="w">

</span><span class="nc">Repo</span><span class="o">.</span><span class="n">aggregate</span><span class="p" data-group-id="2430018039-12">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">:count</span><span class="p">,</span><span class="w"> </span><span class="ss">:id</span><span class="p" data-group-id="2430018039-12">)</span><span class="w"> </span><span class="c1"># =&gt; 0</span><span class="w">
</span><span class="nc">PaperTrail.Version</span><span class="o">.</span><span class="n">count</span><span class="p" data-group-id="2430018039-13">(</span><span class="p" data-group-id="2430018039-13">)</span><span class="w"> </span><span class="c1"># =&gt; 3</span><span class="w">
</span><span class="c1"># same as Repo.aggregate(PaperTrail.Version, :count, :id)</span><span class="w">

</span><span class="nc">PaperTrail.Version</span><span class="o">.</span><span class="n">last</span><span class="p" data-group-id="2430018039-14">(</span><span class="p" data-group-id="2430018039-14">)</span><span class="w"> </span><span class="c1"># returns the last version in the db by inserted_at</span><span class="w">
</span><span class="c1">#  %PaperTrail.Version{__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;versions&quot;&gt;,</span><span class="w">
</span><span class="c1">#   event: &quot;delete&quot;, id: 3, inserted_at: ~N[2016-09-15 22:22:12],</span><span class="w">
</span><span class="c1">#   item_changes: %{&quot;title&quot; =&gt; &quot;Elixir matures fast&quot;, content: &quot;Future is already here, Elixir is the next step!&quot;, &quot;id&quot; =&gt; 1,</span><span class="w">
</span><span class="c1">#     &quot;inserted_at&quot; =&gt; &quot;2016-09-15T21:42:38&quot;,</span><span class="w">
</span><span class="c1">#     &quot;updated_at&quot; =&gt; &quot;2016-09-15T22:00:59&quot;},</span><span class="w">
</span><span class="c1">#   item_id: 1, item_type: &quot;Post&quot;, originator_id: nil, originator: nil, meta: nil}</span></code></pre><h2 id="module-working-with-multi-tenancy" class="section-heading">
  <a href="#module-working-with-multi-tenancy" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Working with multi tenancy</span>
</h2>
<p>Sometimes you have to deal with applications where you need multi tenancy capabilities,
and you want to keep tracking of the versions of your data on different schemas (PostgreSQL)
or databases (MySQL).</p><p>You can use the <a href="https://hexdocs.pm/ecto/Ecto.Query.html#module-query-prefix">Ecto.Query prefix</a>
in order to switch between different schemas/databases for your own data, so
you can specify in your changeset where to store your record. Example:</p><pre><code class="makeup elixir" translate="no"><span class="n">tenant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tenant_id&quot;</span><span class="w">
</span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">User</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="9835089789-1">(</span><span class="p" data-group-id="9835089789-2">%</span><span class="nc" data-group-id="9835089789-2">User</span><span class="p" data-group-id="9835089789-2">{</span><span class="p" data-group-id="9835089789-2">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9835089789-3">%{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Izel&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">last_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Nakri&quot;</span><span class="p" data-group-id="9835089789-3">}</span><span class="p" data-group-id="9835089789-1">)</span><span class="w">

</span><span class="n">changeset</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Queryable</span><span class="o">.</span><span class="n">to_query</span><span class="p" data-group-id="9835089789-4">(</span><span class="p" data-group-id="9835089789-4">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">put</span><span class="p" data-group-id="9835089789-5">(</span><span class="ss">:prefix</span><span class="p">,</span><span class="w"> </span><span class="n">tenant</span><span class="p" data-group-id="9835089789-5">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="9835089789-6">(</span><span class="p" data-group-id="9835089789-6">)</span></code></pre><p>PaperTrail also allows you to store the <a href="https://hexdocs.pm/elixir/Version.html"><code class="inline">Version</code></a> entries generated by your activity in
different schemas/databases by using the value of the element <code class="inline">:prefix</code> on the options
of the functions. Example:</p><pre><code class="makeup elixir" translate="no"><span class="n">tenant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tenant_id&quot;</span><span class="w">

</span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">User</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="7909814002-1">(</span><span class="p" data-group-id="7909814002-2">%</span><span class="nc" data-group-id="7909814002-2">User</span><span class="p" data-group-id="7909814002-2">{</span><span class="p" data-group-id="7909814002-2">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7909814002-3">%{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Izel&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">last_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Nakri&quot;</span><span class="p" data-group-id="7909814002-3">}</span><span class="p" data-group-id="7909814002-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Queryable</span><span class="o">.</span><span class="n">to_query</span><span class="p" data-group-id="7909814002-4">(</span><span class="p" data-group-id="7909814002-4">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">put</span><span class="p" data-group-id="7909814002-5">(</span><span class="ss">:prefix</span><span class="p">,</span><span class="w"> </span><span class="n">tenant</span><span class="p" data-group-id="7909814002-5">)</span><span class="w">

</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="7909814002-6">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7909814002-7">[</span><span class="ss">prefix</span><span class="p">:</span><span class="w"> </span><span class="n">tenant</span><span class="p" data-group-id="7909814002-7">]</span><span class="p" data-group-id="7909814002-6">)</span></code></pre><p>By doing this, you're storing the new <code class="inline">User</code> entry into the schema/database
specified by the <code class="inline">:prefix</code> value (<code class="inline">tenant_id</code>).</p><p>Note that the <code class="inline">User</code>'s changeset it's sent with the <code class="inline">:prefix</code>, so PaperTrail <strong>will take care of the
storage of the generated <a href="https://hexdocs.pm/elixir/Version.html"><code class="inline">Version</code></a> entry in the desired schema/database</strong>. Make sure
to add this prefix to your changeset before the execution of the PaperTrail function if you want to do versioning on a separate schema.</p><p>PaperTrail can also get versions of records or models from different schemas/databases as well
by using the <code class="inline">:prefix</code> option. Example:</p><pre><code class="makeup elixir" translate="no"><span class="n">tenant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tenant_id&quot;</span><span class="w">
</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">

</span><span class="nc">PaperTrail</span><span class="o">.</span><span class="n">get_versions</span><span class="p" data-group-id="1810349294-1">(</span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1810349294-2">[</span><span class="ss">prefix</span><span class="p">:</span><span class="w"> </span><span class="n">tenant</span><span class="p" data-group-id="1810349294-2">]</span><span class="p" data-group-id="1810349294-1">)</span></code></pre><h2 id="module-version-timestamps" class="section-heading">
  <a href="#module-version-timestamps" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Version timestamps</span>
</h2>
<p>PaperTrail can be configured to use <code class="inline">utc_datetime</code> or <code class="inline">utc_datetime_usec</code> for Version timestamps.</p><pre><code class="makeup elixir" translate="no"><span class="c1"># In your config/config.exs</span><span class="w">
</span><span class="n">config</span><span class="w"> </span><span class="ss">:paper_trail</span><span class="p">,</span><span class="w"> </span><span class="ss">timestamps_type</span><span class="p">:</span><span class="w"> </span><span class="ss">:utc_datetime</span></code></pre><p>Note: You will need to recompile your deps after you have added the config for timestamps.</p><h2 id="module-suggestions" class="section-heading">
  <a href="#module-suggestions" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Suggestions</span>
</h2>
<ul><li>PaperTrail.Version(s) order matter,</li><li>Don't delete your paper_trail versions, instead you can merge them</li><li>If you have a question or a problem, do not hesitate to create an issue or submit a pull request</li></ul><h2 id="module-contributing" class="section-heading">
  <a href="#module-contributing" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Contributing</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">set</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="w">
</span><span class="n">source</span><span class="w"> </span><span class="o">.</span><span class="n">env</span><span class="w">
</span><span class="n">mix</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">--</span><span class="n">trace</span></code></pre><h1>Credits</h1><p>Many thanks to:</p><ul><li><a href="https://github.com/josepablocastro">Jose Pablo Castro</a> - Built the repo configuration for paper_trail</li><li><a href="https://github.com/hdtafur">Harold Tafur</a> - Built the <code class="inline">:ecto_options</code> option for PaperTrail inserts</li><li><a href="https://github.com/FlorianGerhardt">Florian Gerhardt</a> - Fixed rare compile errors for PaperTrail repos</li><li><a href="https://github.com/asiniy">Alex Antonov</a> - Original inventor of the originator feature</li><li><a href="https://github.com/narrowtux">Moritz Schmale</a> - UUID primary keys feature</li><li><a href="https://github.com/drapergeek">Jason Draper</a> - UUID primary keys feature</li><li><a href="https://github.com/maennchen">Jonatan MÃ¤nnchen</a> - Added non-regular :binary_id UUID support for originator</li><li><a href="https://github.com/joshuataylor">Josh Taylor</a> - Maintenance and new feature suggestions</li><li><a href="https://github.com/mitchellhenke">Mitchell Henke</a> - Fixed weird elixir compiler warnings</li><li><a href="https://github.com/dreamingechoes">IvÃ¡n GonzÃ¡lez</a> - Multi tenancy feature and some minor refactors</li><li><a href="https://github.com/seymores">Teo Choong Ping</a> - Fixed paper_trail references for newer Elixir versions</li><li><a href="https://github.com/devvit">devvit</a> - Added non-regular primary key tracking support</li><li><a href="https://github.com/rustamtolipov">rustamtolipov</a> - Added support for Ecto v3</li><li><a href="https://github.com/gabrielpra1">gabrielpra1</a> - Added enhanced support for Ecto.Changeset</li><li><a href="https://github.com/DiscoStarslayer">Darren Thompson</a> - Added PaperTrail.Multi which makes paper trail transactions more usable</li><li><a href="https://github.com/hdtafur">Harold Tafur</a> - Made PaperTrail.insert accept :ecto_options params(ie. upsert options)</li><li><a href="https://github.com/szaboat">Attila Szabo</a> - Made %Version[:inserted_at] accept different ecto datetime options</li><li><a href="https://github.com/rschef">Rafael Scheffer</a> - Built PaperTrail.Serializer that unifies %Version{} serialization</li><li><a href="https://github.com/kianmeng">Kian Meng Ang</a> - Improved documentation</li><li><a href="https://github.com/fv316">Francisco Correia</a> - Made PaperTrail transaction keys and ecto transactions more customizable</li><li><a href="https://github.com/ottobar">Don Barlow</a> - Made :initial_version_key configurable for <code class="inline">strict_mode</code> inserts</li><li><a href="https://github.com/cschmatzler">Christoph Schmatzler</a> - Built PaperTrail.insert_or_update feature</li><li><a href="https://github.com/izelnakri">Izel Nakri</a> - The Originator of this library. See what I did there ;)</li></ul><p>Additional thanks to:</p><ul><li><a href="https://github.com/airblade/paper_trail">Ruby paper_trail gem</a> - Initial inspiration of this project.</li><li><a href="https://github.com/elixir-ecto/ecto">Ecto</a> - For the great API.</li></ul><h2 id="module-license" class="section-heading">
  <a href="#module-license" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">License</span>
</h2>
<p>This source code is licensed under the MIT license. Copyright (c) 2016-present Izel Nakri.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#add_prefix/2" data-no-tooltip translate="no">add_prefix(schema, prefix)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.Serializer.html#add_prefix/2"><code class="inline">PaperTrail.Serializer.add_prefix/2</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete/2" data-no-tooltip translate="no">delete(model_or_changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</a>

      </div>

        <div class="summary-synopsis"><p>Deletes a record from the database with a related version insertion in one transaction</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete!/2" data-no-tooltip translate="no">delete!(model_or_changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</a>

      </div>

        <div class="summary-synopsis"><p>Same as delete/2 but returns only the model struct or raises if the changeset is invalid.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_current_model/1" data-no-tooltip translate="no">get_current_model(version)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.VersionQueries.html#get_current_model/1"><code class="inline">PaperTrail.VersionQueries.get_current_model/1</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_item_type/1" data-no-tooltip translate="no">get_item_type(data)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.Serializer.html#get_item_type/1"><code class="inline">PaperTrail.Serializer.get_item_type/1</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_model_id/1" data-no-tooltip translate="no">get_model_id(model)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.Serializer.html#get_model_id/1"><code class="inline">PaperTrail.Serializer.get_model_id/1</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_sequence_id/1" data-no-tooltip translate="no">get_sequence_id(table_name)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.Serializer.html#get_sequence_id/1"><code class="inline">PaperTrail.Serializer.get_sequence_id/1</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_version/1" data-no-tooltip translate="no">get_version(record)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.VersionQueries.html#get_version/1"><code class="inline">PaperTrail.VersionQueries.get_version/1</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_version/2" data-no-tooltip translate="no">get_version(model_or_record, id_or_options)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.VersionQueries.html#get_version/2"><code class="inline">PaperTrail.VersionQueries.get_version/2</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_version/3" data-no-tooltip translate="no">get_version(model, id, options)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.VersionQueries.html#get_version/3"><code class="inline">PaperTrail.VersionQueries.get_version/3</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_versions/1" data-no-tooltip translate="no">get_versions(record)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.VersionQueries.html#get_versions/1"><code class="inline">PaperTrail.VersionQueries.get_versions/1</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_versions/2" data-no-tooltip translate="no">get_versions(model_or_record, id_or_options)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.VersionQueries.html#get_versions/2"><code class="inline">PaperTrail.VersionQueries.get_versions/2</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_versions/3" data-no-tooltip translate="no">get_versions(model, id, options)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.VersionQueries.html#get_versions/3"><code class="inline">PaperTrail.VersionQueries.get_versions/3</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#has_version?/1" data-no-tooltip translate="no">has_version?(record)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.VersionQueries.html#has_version?/1"><code class="inline">PaperTrail.VersionQueries.has_version?/1</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#has_version?/2" data-no-tooltip translate="no">has_version?(model_or_record, id_or_options)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.VersionQueries.html#has_version?/2"><code class="inline">PaperTrail.VersionQueries.has_version?/2</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#has_version?/3" data-no-tooltip translate="no">has_version?(model, id, options)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.VersionQueries.html#has_version?/3"><code class="inline">PaperTrail.VersionQueries.has_version?/3</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#initialise/2" data-no-tooltip translate="no">initialise(model, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, version_key: :version])</a>

      </div>

        <div class="summary-synopsis"><p>Explicitly inserts a non-versioned already existing record into the Versions table</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#insert/2" data-no-tooltip translate="no">insert(changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</a>

      </div>

        <div class="summary-synopsis"><p>Inserts a record to the database with a related version insertion in one transaction</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#insert!/2" data-no-tooltip translate="no">insert!(changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</a>

      </div>

        <div class="summary-synopsis"><p>Same as insert/2 but returns only the model struct or raises if the changeset is invalid.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#insert_or_update/2" data-no-tooltip translate="no">insert_or_update(changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</a>

      </div>

        <div class="summary-synopsis"><p>Upserts a record to the database with a related version insertion in one transaction.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#insert_or_update!/2" data-no-tooltip translate="no">insert_or_update!(changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</a>

      </div>

        <div class="summary-synopsis"><p>Same as insert_or_update/2 but returns only the model struct or raises if the changeset is invalid.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#make_version_struct/3" data-no-tooltip translate="no">make_version_struct(version, model, options)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.Serializer.html#make_version_struct/3"><code class="inline">PaperTrail.Serializer.make_version_struct/3</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#serialize/1" data-no-tooltip translate="no">serialize(data)</a>

      </div>

        <div class="summary-synopsis"><p>See <a href="./PaperTrail.Serializer.html#serialize/1"><code class="inline">PaperTrail.Serializer.serialize/1</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update/2" data-no-tooltip translate="no">update(changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</a>

      </div>

        <div class="summary-synopsis"><p>Updates a record from the database with a related version insertion in one transaction</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update!/2" data-no-tooltip translate="no">update!(changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</a>

      </div>

        <div class="summary-synopsis"><p>Same as update/2 but returns only the model struct or raises if the changeset is invalid.</p></div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="add_prefix/2">

  <div class="detail-header">
    <a href="#add_prefix/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">add_prefix(schema, prefix)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L20" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.Serializer.html#add_prefix/2"><code class="inline">PaperTrail.Serializer.add_prefix/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="delete/2">

    <span id="delete/1"></span>

  <div class="detail-header">
    <a href="#delete/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete(model_or_changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L130" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> delete(
  model_or_changeset :: model | <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.Changeset.html#t:t/1">Ecto.Changeset.t</a>(model),
  options :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) ::
  {:ok, %{model: model, version: <a href="./PaperTrail.Version.html#t:t/0">PaperTrail.Version.t</a>()}}
  | {:error, <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.Changeset.html#t:t/1">Ecto.Changeset.t</a>(model) | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()}
when model: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">struct</a>()</pre>

      </div>

<p>Deletes a record from the database with a related version insertion in one transaction</p>
  </section>
</section>
<section class="detail" id="delete!/2">

    <span id="delete!/1"></span>

  <div class="detail-header">
    <a href="#delete!/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete!(model_or_changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L142" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> delete!(
  model_or_changeset :: model | <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.Changeset.html#t:t/1">Ecto.Changeset.t</a>(model),
  options :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) :: model
when model: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">struct</a>()</pre>

      </div>

<p>Same as delete/2 but returns only the model struct or raises if the changeset is invalid.</p>
  </section>
</section>
<section class="detail" id="get_current_model/1">

  <div class="detail-header">
    <a href="#get_current_model/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_current_model(version)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L16" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.VersionQueries.html#get_current_model/1"><code class="inline">PaperTrail.VersionQueries.get_current_model/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_item_type/1">

  <div class="detail-header">
    <a href="#get_item_type/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_item_type(data)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L21" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.Serializer.html#get_item_type/1"><code class="inline">PaperTrail.Serializer.get_item_type/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_model_id/1">

  <div class="detail-header">
    <a href="#get_model_id/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_model_id(model)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L22" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.Serializer.html#get_model_id/1"><code class="inline">PaperTrail.Serializer.get_model_id/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_sequence_id/1">

  <div class="detail-header">
    <a href="#get_sequence_id/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_sequence_id(table_name)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L19" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.Serializer.html#get_sequence_id/1"><code class="inline">PaperTrail.Serializer.get_sequence_id/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_version/1">

  <div class="detail-header">
    <a href="#get_version/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_version(record)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L7" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.VersionQueries.html#get_version/1"><code class="inline">PaperTrail.VersionQueries.get_version/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_version/2">

  <div class="detail-header">
    <a href="#get_version/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_version(model_or_record, id_or_options)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L8" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.VersionQueries.html#get_version/2"><code class="inline">PaperTrail.VersionQueries.get_version/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_version/3">

  <div class="detail-header">
    <a href="#get_version/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_version(model, id, options)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L9" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.VersionQueries.html#get_version/3"><code class="inline">PaperTrail.VersionQueries.get_version/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_versions/1">

  <div class="detail-header">
    <a href="#get_versions/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_versions(record)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L13" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.VersionQueries.html#get_versions/1"><code class="inline">PaperTrail.VersionQueries.get_versions/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_versions/2">

  <div class="detail-header">
    <a href="#get_versions/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_versions(model_or_record, id_or_options)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L14" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.VersionQueries.html#get_versions/2"><code class="inline">PaperTrail.VersionQueries.get_versions/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_versions/3">

  <div class="detail-header">
    <a href="#get_versions/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_versions(model, id, options)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L15" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.VersionQueries.html#get_versions/3"><code class="inline">PaperTrail.VersionQueries.get_versions/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="has_version?/1">

  <div class="detail-header">
    <a href="#has_version?/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">has_version?(record)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L10" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.VersionQueries.html#has_version?/1"><code class="inline">PaperTrail.VersionQueries.has_version?/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="has_version?/2">

  <div class="detail-header">
    <a href="#has_version?/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">has_version?(model_or_record, id_or_options)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L11" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.VersionQueries.html#has_version?/2"><code class="inline">PaperTrail.VersionQueries.has_version?/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="has_version?/3">

  <div class="detail-header">
    <a href="#has_version?/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">has_version?(model, id, options)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L12" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.VersionQueries.html#has_version?/3"><code class="inline">PaperTrail.VersionQueries.has_version?/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="initialise/2">

    <span id="initialise/1"></span>

  <div class="detail-header">
    <a href="#initialise/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">initialise(model, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, version_key: :version])</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L37" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Explicitly inserts a non-versioned already existing record into the Versions table</p>
  </section>
</section>
<section class="detail" id="insert/2">

    <span id="insert/1"></span>

  <div class="detail-header">
    <a href="#insert/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">insert(changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L61" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> insert(
  changeset :: <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.Changeset.html#t:t/1">Ecto.Changeset.t</a>(model),
  options :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) ::
  {:ok, %{model: model, version: <a href="./PaperTrail.Version.html#t:t/0">PaperTrail.Version.t</a>()}}
  | {:error, <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.Changeset.html#t:t/1">Ecto.Changeset.t</a>(model) | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()}
when model: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">struct</a>()</pre>

      </div>

<p>Inserts a record to the database with a related version insertion in one transaction</p>
  </section>
</section>
<section class="detail" id="insert!/2">

    <span id="insert!/1"></span>

  <div class="detail-header">
    <a href="#insert!/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">insert!(changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L72" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> insert!(changeset :: <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.Changeset.html#t:t/1">Ecto.Changeset.t</a>(model), options :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) :: model
when model: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">struct</a>()</pre>

      </div>

<p>Same as insert/2 but returns only the model struct or raises if the changeset is invalid.</p>
  </section>
</section>
<section class="detail" id="insert_or_update/2">

    <span id="insert_or_update/1"></span>

  <div class="detail-header">
    <a href="#insert_or_update/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">insert_or_update(changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L84" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> insert_or_update(changeset :: <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.Changeset.html#t:t/1">Ecto.Changeset.t</a>(model), options :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) ::
  {:ok, %{model: model, version: <a href="./PaperTrail.Version.html#t:t/0">PaperTrail.Version.t</a>()}}
  | {:error, <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.Changeset.html#t:t/1">Ecto.Changeset.t</a>(model) | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()}
when model: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">struct</a>()</pre>

      </div>

<p>Upserts a record to the database with a related version insertion in one transaction.</p>
  </section>
</section>
<section class="detail" id="insert_or_update!/2">

    <span id="insert_or_update!/1"></span>

  <div class="detail-header">
    <a href="#insert_or_update!/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">insert_or_update!(changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L95" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> insert_or_update!(changeset :: <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.Changeset.html#t:t/1">Ecto.Changeset.t</a>(model), options :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) ::
  model
when model: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">struct</a>()</pre>

      </div>

<p>Same as insert_or_update/2 but returns only the model struct or raises if the changeset is invalid.</p>
  </section>
</section>
<section class="detail" id="make_version_struct/3">

  <div class="detail-header">
    <a href="#make_version_struct/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">make_version_struct(version, model, options)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L17" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.Serializer.html#make_version_struct/3"><code class="inline">PaperTrail.Serializer.make_version_struct/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="serialize/1">

  <div class="detail-header">
    <a href="#serialize/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">serialize(data)</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L18" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>See <a href="./PaperTrail.Serializer.html#serialize/1"><code class="inline">PaperTrail.Serializer.serialize/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="update/2">

    <span id="update/1"></span>

  <div class="detail-header">
    <a href="#update/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update(changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L107" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> update(changeset :: <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.Changeset.html#t:t/1">Ecto.Changeset.t</a>(model), options :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) ::
  {:ok, %{model: model, version: <a href="./PaperTrail.Version.html#t:t/0">PaperTrail.Version.t</a>()}}
  | {:error, <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.Changeset.html#t:t/1">Ecto.Changeset.t</a>(model) | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()}
when model: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">struct</a>()</pre>

      </div>

<p>Updates a record from the database with a related version insertion in one transaction</p>
  </section>
</section>
<section class="detail" id="update!/2">

    <span id="update!/1"></span>

  <div class="detail-header">
    <a href="#update!/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update!(changeset, options \\ [origin: nil, meta: nil, originator: nil, prefix: nil, model_key: :model, version_key: :version, ecto_options: []])</h1>

      <a href="https://github.com/bonfire-networks/paper_trail/blob/main/lib/paper_trail.ex#L118" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> update!(changeset :: <a href="https://hexdocs.pm/ecto/3.12.2/Ecto.Changeset.html#t:t/1">Ecto.Changeset.t</a>(model), options :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) :: model
when model: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">struct</a>()</pre>

      </div>

<p>Same as update/2 but returns only the model struct or raises if the changeset is invalid.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Bonfire.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
